<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>paracrine API documentation</title>
<meta name="description" content="Paracrine is a system deployment tool. It&#39;s based around Mitogen and standard Python packages for
features (although, currently there&#39;s only the one â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Package <code>paracrine</code></h1>
</header>
<section id="section-intro">
<p>Paracrine is a system deployment tool. It's based around Mitogen and standard Python packages for
features (although, currently there's only the one core package). Current status is essentially,
"works for me, probably won't eat your computer", but thoughts and patches are welcomed.</p>
<p>It's designed towards rapid idempotent deploys i.e. a zero-changes deploy should take in the order of a small number of seconds ideally, and so can be used as your application deployment option as well as for system changes, which has the design benefit of you could use it for GitOps-style deploys. Obviously, if you do more changes, it'll take longer, but that's generally less of an issue, but it should still be faster than most other tooling options. It assumes it's got a host system to run from, which <em>probably</em> can be anything that runs Python, but the testing for that so far has been on a Debian laptop.</p>
<p>It's named after <a href="https://en.wikipedia.org/wiki/Paracrine_signaling">Paracrine signaling</a> "a type of cellular communication in which a cell produces a signal to induce changes in nearby cells" which feels pretty accurate for a deployment tool.</p>
<h2 id="usage">Usage</h2>
<ol>
<li>Setup Python. Tested against 3.8+</li>
<li><code>pip install <a title="paracrine" href="#paracrine">paracrine</a></code></li>
<li>Write a main file describing what you want to setup. <a href="integration_test/main.py">integration_test/main.py</a> is a reasonable example. It must call the <code>run</code> function, which takes arguments for the inventory file, and list of modules to run.</li>
<li>Write an inventory file for the machines this is managing. Current setup assumes they're all the same. <a href="integration_test/docker/inventory.yaml">integration_test/docker/inventory.yaml</a> is a reasonable example file, but I suggest generating it from whatever you're using to create the servers (e.g. Terraform).</li>
<li>Write a <code>config.yaml</code>. This has a main top-level key of <code>environments</code> with keys below that for each inventory file you've got (<a href="integration_test/config.yaml">integration_test/config.yaml</a> just has one, but in most scenarios you'll have at least a dev and prod setup). What you do below that is up to you, but typically it'll be environment variables and secrets to feed into the main file.</li>
<li>Run <code>python -m paracrine.setup &lt;inventory file&gt;</code> - this will install the minimum python bits so that everything else works.</li>
<li>Run the main file.</li>
</ol>
<h2 id="utilities">Utilities</h2>
<p>All the utilities are callable as <code>python -m paracrine.&lt;utility&gt; &lt;inventory file&gt;</code> and sometimes some extra args</p>
<ul>
<li><code><a title="paracrine.login" href="login.html">paracrine.login</a></code> - login to a specific server in the inventory. Index of which one is an additional arg</li>
<li><code><a title="paracrine.setup" href="setup.html">paracrine.setup</a></code> - this will install the minimum python bits so that everything else works.</li>
</ul>
<h2 id="built-in-modules">Built-in modules</h2>
<ul>
<li><code><a title="paracrine.aws" href="aws.html">paracrine.aws</a></code> - Runs locally, gets the AWS access/secret keys of the current user during bootstrap for access later. Has a function <code>set_aws_creds</code> for setting them in a run step.</li>
<li><code><a title="paracrine.certs" href="certs.html">paracrine.certs</a></code> - Creates SSL certificates via LetsEncrypt. Takes two args "hostname" and "email".</li>
<li><code><a title="paracrine.services.pleroma" href="services/pleroma.html">paracrine.services.pleroma</a></code> - Sets up a <a href="https://pleroma.social/">Pleroma server</a>. Uses the PostgreSQL and certs modules.</li>
<li><code><a title="paracrine.services.postgresql" href="services/postgresql.html">paracrine.services.postgresql</a></code> - Sets up a <a href="https://www.postgresql.org/">PostgresSQL server</a></li>
<li><code><a title="paracrine.services.wireguard" href="services/wireguard.html">paracrine.services.wireguard</a></code> - Sets up <a href="https://www.wireguard.com/">Wireguard</a>. Assumes your inventory template has a unique <code>wireguard_ip</code> line per server.</li>
</ul>
<h2 id="writing-a-module-file">Writing A Module File</h2>
<p>"modules" are just Python files (or packages containing them). They should have one or more specially named functions - all of these are optional, but a module with none of these won't do anything.</p>
<ul>
<li><code>dependencies</code> - Returns a list of modules this module requires (e.g. a database setup). Return type is <code><a title="paracrine.deps.Modules" href="deps.html#paracrine.deps.Modules">Modules</a></code> i.e. a list of either <code>ModuleType</code> or a Tuple of <code>ModuleType</code> and a value to be inserted as the <code>options</code> dictionary into the module.</li>
<li><code>core_local</code> - Function to be run locally i.e. on the running host before connecting to the destination machine</li>
<li><code>core_run</code> - Main function to run on the destination machine</li>
<li><code>core_parse_return</code> - Function to run locally with an argument of the result of running <code>core_run</code></li>
<li><code>bootstrap_local</code>/<code>bootstrap_run</code>/<code>bootstrap_parse_return</code> - Like the <code><a title="paracrine.core" href="core.html">paracrine.core</a></code> ones, but we do all the bootstrap functions first, then run all the core functions. This could be expanded into a n-stage setup, but nothing has needed that yet.</li>
</ul>
<p>You can just use plain Python code, but <code>paracrine.fs/config/debian/network/python/systemd/users</code> have lots of useful functions you should preferably use instead.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Paracrine is a system deployment tool. It&#39;s based around Mitogen and standard Python packages for
features (although, currently there&#39;s only the one core package). Current status is essentially,
&#34;works for me, probably won&#39;t eat your computer&#34;, but thoughts and patches are welcomed.

It&#39;s designed towards rapid idempotent deploys i.e. a zero-changes deploy should take in the order of a small number of seconds ideally, and so can be used as your application deployment option as well as for system changes, which has the design benefit of you could use it for GitOps-style deploys. Obviously, if you do more changes, it&#39;ll take longer, but that&#39;s generally less of an issue, but it should still be faster than most other tooling options. It assumes it&#39;s got a host system to run from, which _probably_ can be anything that runs Python, but the testing for that so far has been on a Debian laptop.

It&#39;s named after [Paracrine signaling](https://en.wikipedia.org/wiki/Paracrine_signaling) &#34;a type of cellular communication in which a cell produces a signal to induce changes in nearby cells&#34; which feels pretty accurate for a deployment tool.

Usage
-----

1. Setup Python. Tested against 3.8+
2. `pip install paracrine`
3. Write a main file describing what you want to setup. [integration_test/main.py](integration_test/main.py) is a reasonable example. It must call the `run` function, which takes arguments for the inventory file, and list of modules to run.
4. Write an inventory file for the machines this is managing. Current setup assumes they&#39;re all the same. [integration_test/docker/inventory.yaml](integration_test/docker/inventory.yaml) is a reasonable example file, but I suggest generating it from whatever you&#39;re using to create the servers (e.g. Terraform).
5. Write a `config.yaml`. This has a main top-level key of `environments` with keys below that for each inventory file you&#39;ve got ([integration_test/config.yaml](integration_test/config.yaml) just has one, but in most scenarios you&#39;ll have at least a dev and prod setup). What you do below that is up to you, but typically it&#39;ll be environment variables and secrets to feed into the main file.
6. Run `python -m paracrine.setup &lt;inventory file&gt;` - this will install the minimum python bits so that everything else works.
7. Run the main file.

Utilities
---
All the utilities are callable as `python -m paracrine.&lt;utility&gt; &lt;inventory file&gt;` and sometimes some extra args

* `paracrine.login` - login to a specific server in the inventory. Index of which one is an additional arg
* `paracrine.setup` - this will install the minimum python bits so that everything else works.

Built-in modules
---
* `paracrine.aws` - Runs locally, gets the AWS access/secret keys of the current user during bootstrap for access later. Has a function `set_aws_creds` for setting them in a run step.
* `paracrine.certs` - Creates SSL certificates via LetsEncrypt. Takes two args &#34;hostname&#34; and &#34;email&#34;.
* `paracrine.services.pleroma` - Sets up a [Pleroma server](https://pleroma.social/). Uses the PostgreSQL and certs modules.
* `paracrine.services.postgresql` - Sets up a [PostgresSQL server](https://www.postgresql.org/)
* `paracrine.services.wireguard` - Sets up [Wireguard](https://www.wireguard.com/). Assumes your inventory template has a unique `wireguard_ip` line per server.

Writing a module file
---

&#34;modules&#34; are just Python files (or packages containing them). They should have one or more specially named functions - all of these are optional, but a module with none of these won&#39;t do anything.

* `dependencies` - Returns a list of modules this module requires (e.g. a database setup). Return type is `paracrine.deps.Modules` i.e. a list of either `ModuleType` or a Tuple of `ModuleType` and a value to be inserted as the `options` dictionary into the module.
* `core_local` - Function to be run locally i.e. on the running host before connecting to the destination machine
* `core_run` - Main function to run on the destination machine
* `core_parse_return` - Function to run locally with an argument of the result of running `core_run`
* `bootstrap_local`/`bootstrap_run`/`bootstrap_parse_return` - Like the `core` ones, but we do all the bootstrap functions first, then run all the core functions. This could be expanded into a n-stage setup, but nothing has needed that yet.

You can just use plain Python code, but `paracrine.fs/config/debian/network/python/systemd/users` have lots of useful functions you should preferably use instead.
&#34;&#34;&#34;</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="paracrine.aws" href="aws.html">paracrine.aws</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="paracrine.certs" href="certs.html">paracrine.certs</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="paracrine.config" href="config.html">paracrine.config</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="paracrine.core" href="core.html">paracrine.core</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="paracrine.debian" href="debian.html">paracrine.debian</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="paracrine.deps" href="deps.html">paracrine.deps</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="paracrine.fs" href="fs.html">paracrine.fs</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="paracrine.login" href="login.html">paracrine.login</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="paracrine.network" href="network.html">paracrine.network</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="paracrine.python" href="python.html">paracrine.python</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="paracrine.reboot" href="reboot.html">paracrine.reboot</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="paracrine.runner" href="runner.html">paracrine.runner</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="paracrine.services" href="services/index.html">paracrine.services</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="paracrine.setup" href="setup.html">paracrine.setup</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="paracrine.systemd" href="systemd.html">paracrine.systemd</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="paracrine.users" href="users.html">paracrine.users</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#usage">Usage</a></li>
<li><a href="#utilities">Utilities</a></li>
<li><a href="#built-in-modules">Built-in modules</a></li>
<li><a href="#writing-a-module-file">Writing a module file</a></li>
</ul>
</div>
<ul id="index">
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="paracrine.aws" href="aws.html">paracrine.aws</a></code></li>
<li><code><a title="paracrine.certs" href="certs.html">paracrine.certs</a></code></li>
<li><code><a title="paracrine.config" href="config.html">paracrine.config</a></code></li>
<li><code><a title="paracrine.core" href="core.html">paracrine.core</a></code></li>
<li><code><a title="paracrine.debian" href="debian.html">paracrine.debian</a></code></li>
<li><code><a title="paracrine.deps" href="deps.html">paracrine.deps</a></code></li>
<li><code><a title="paracrine.fs" href="fs.html">paracrine.fs</a></code></li>
<li><code><a title="paracrine.login" href="login.html">paracrine.login</a></code></li>
<li><code><a title="paracrine.network" href="network.html">paracrine.network</a></code></li>
<li><code><a title="paracrine.python" href="python.html">paracrine.python</a></code></li>
<li><code><a title="paracrine.reboot" href="reboot.html">paracrine.reboot</a></code></li>
<li><code><a title="paracrine.runner" href="runner.html">paracrine.runner</a></code></li>
<li><code><a title="paracrine.services" href="services/index.html">paracrine.services</a></code></li>
<li><code><a title="paracrine.setup" href="setup.html">paracrine.setup</a></code></li>
<li><code><a title="paracrine.systemd" href="systemd.html">paracrine.systemd</a></code></li>
<li><code><a title="paracrine.users" href="users.html">paracrine.users</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>
